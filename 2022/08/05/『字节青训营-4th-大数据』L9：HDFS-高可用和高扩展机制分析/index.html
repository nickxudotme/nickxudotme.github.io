<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>『字节青训营-4th-大数据』L9：HDFS 高可用和高扩展机制分析 | NX の 博客</title><meta name="author" content="Nick Xu"><meta name="copyright" content="Nick Xu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="相关链接🎶 学员手册：【大数据专场 学习资料三】第四届字节跳动青训营 - 掘金  元数据高可用 高可用的需求 服务高可用的需求  高可用的衡量  故障度量的指标  MTTR（Mean Time To Repair）：平均修复时间，系统能多快恢复。 MTTF（Mean Time To Fail..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "『字节青训营-4th-大数据』L9：HDFS 高可用和高扩展机制分析",
  "url": "https://nickxu.me/2022/08/05/%E3%80%8E%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5-4th-%E5%A4%A7%E6%95%B0%E6%8D%AE%E3%80%8FL9%EF%BC%9AHDFS-%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E9%AB%98%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90/",
  "image": "https://nickxu.me/static/202202230023069.jpg",
  "datePublished": "2022-08-05T08:14:20.000Z",
  "dateModified": "2023-08-15T05:42:18.229Z",
  "author": [
    {
      "@type": "Person",
      "name": "Nick Xu",
      "url": "https://nickxu.me"
    }
  ]
}</script><link rel="shortcut icon" href="/static/icon.png"><link rel="canonical" href="https://nickxu.me/2022/08/05/%E3%80%8E%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5-4th-%E5%A4%A7%E6%95%B0%E6%8D%AE%E3%80%8FL9%EF%BC%9AHDFS-%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E9%AB%98%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90/index.html"><link rel="preconnect"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css?v=7.1.0"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3573ab9aac9d53e5c34fea51e076a07d";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-VBKFEG3YFD"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-VBKFEG3YFD')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-VBKFEG3YFD', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js?v=4.12.0',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '『字节青训营-4th-大数据』L9：HDFS 高可用和高扩展机制分析',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/static/my.css"><script async src="https://analytics.umami.is/script.js" data-website-id="cabaee36-5ea6-431c-8f56-4127be850896"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="NX の 博客" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="NX の 博客" type="application/rss+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/static/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">300</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-coffee"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/contact/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/bookmarks/"><i class="fa-fw fas fa-bookmark"></i><span> 网址收藏</span></a></li><li><a class="site-page child" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/static/202202230023069.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">NX の 博客</span></a><a class="nav-page-title" href="/"><span class="site-name">『字节青训营-4th-大数据』L9：HDFS 高可用和高扩展机制分析</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-coffee"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/contact/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/bookmarks/"><i class="fa-fw fas fa-bookmark"></i><span> 网址收藏</span></a></li><li><a class="site-page child" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">『字节青训营-4th-大数据』L9：HDFS 高可用和高扩展机制分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-05T08:14:20.000Z" title="发表于 2022-08-05 16:14:20">2022-08-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-15T05:42:18.229Z" title="更新于 2023-08-15 13:42:18">2023-08-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%92%E8%AE%AD%E8%90%A5/">青训营</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%92%E8%AE%AD%E8%90%A5/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-4th-%E5%A4%A7%E6%95%B0%E6%8D%AE/">字节跳动-4th-大数据</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">750</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>2分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:300,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-08-15 13:42:18&quot;}" hidden></div><details class="toggle" ><summary class="toggle-button" style="">相关链接</summary><div class="toggle-content"><p>🎶 学员手册：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7124948585614934029#heading-24">【大数据专场 学习资料三】第四届字节跳动青训营 - 掘金</a></p>
</div></details>
<h1 id="元数据高可用">元数据高可用</h1>
<h2 id="高可用的需求">高可用的需求</h2>
<h3 id="服务高可用的需求">服务高可用的需求</h3>
<p><img src="https://image.nickxu.me/202208052026501.png" alt="image-20220805202606209"></p>
<h3 id="高可用的衡量">高可用的衡量</h3>
<p><img src="https://image.nickxu.me/202208052027150.png" alt="image-20220805202736923"></p>
<p>故障度量的指标</p>
<ul>
<li>MTTR（Mean Time To Repair）：平均修复时间，系统能多快恢复。</li>
<li>MTTF（Mean Time To Failure）：平均失效时间，运行到故障间的时间，一般用于不可修复的系统（制造业）</li>
<li>MTBF（Mean Time Between Failures）：平均无故障时间，两次故障间的间隔，一般用于可修复的系统（软件）</li>
</ul>
<h3 id="可用性的年化">可用性的年化</h3>
<p><img src="https://image.nickxu.me/202208052029454.png" alt="image-20220805202943236"></p>
<h3 id="高可用的形式">高可用的形式</h3>
<p><img src="https://image.nickxu.me/202208052031609.png" alt="image-20220805203118407"></p>
<h2 id="HDFS-主备同步实现">HDFS 主备同步实现</h2>
<h3 id="HDFS-NameNode-高可用架构">HDFS NameNode 高可用架构</h3>
<p><img src="https://image.nickxu.me/202208052033929.png" alt="image-20220805203333753"></p>
<h3 id="理论基础-状态机复制和日志">理论基础 - 状态机复制和日志</h3>
<p><img src="https://image.nickxu.me/202208052035207.png" alt="image-20220805203549996"></p>
<h3 id="NameNode-操作日志的生产消费">NameNode 操作日志的生产消费</h3>
<p><img src="https://image.nickxu.me/202208052037982.png" alt="image-20220805203713795"></p>
<h3 id="NameNode-块状态维护">NameNode 块状态维护</h3>
<p><img src="https://image.nickxu.me/202208241544204.png" alt="image-20220805203936939"></p>
<h2 id="HDFS-自动主备切换">HDFS 自动主备切换</h2>
<h3 id="分布式协调组件-ZooKeeper">分布式协调组件 - ZooKeeper</h3>
<p><img src="https://image.nickxu.me/202208052043801.png" alt="image-20220805204326568"></p>
<h3 id="自动主备切换流程-Server-侧">自动主备切换流程 - Server 侧</h3>
<p><img src="https://image.nickxu.me/202208052050382.png" alt="image-20220805205016116"></p>
<p>脑裂问题：多个节点都认为自己是 active，都会去写日志</p>
<p>Fence 机制：会阻止多个节点同时写日志</p>
<h3 id="自动主备切换流程-Client-侧">自动主备切换流程 - Client 侧</h3>
<p><img src="https://image.nickxu.me/202208052051326.png" alt="image-20220805205154093"></p>
<p>过去，只存一个 ND 的地址，但现在会存一组，然后依次轮询，如果是 Standby 就一直往后找，直到找到一个 active</p>
<h2 id="日志系统-BookKeeper-简介">日志系统 BookKeeper 简介</h2>
<h3 id="BookKeeper-架构">BookKeeper 架构</h3>
<p><img src="https://image.nickxu.me/202208182103022.png" alt="image-20220805205346900"></p>
<h3 id="Quorum-机制">Quorum 机制</h3>
<p><img src="https://image.nickxu.me/202208131200722.png" alt="image-20220813120059594"></p>
<h3 id="BookKeeper-Quorum">BookKeeper Quorum</h3>
<p><img src="https://image.nickxu.me/202208131202547.png" alt="image-20220813120244437"></p>
<h3 id="BookKeeper-Ensemble">BookKeeper Ensemble</h3>
<p><img src="https://image.nickxu.me/202208131203575.png" alt="image-20220813120349472"></p>
<h1 id="数据存储高可用">数据存储高可用</h1>
<h2 id="单机存储的数据高可用机制">单机存储的数据高可用机制</h2>
<h3 id="RAID">RAID</h3>
<p><img src="https://image.nickxu.me/202208131205106.png" alt="image-20220813120525973"></p>
<h3 id="RAID-方案讲解">RAID 方案讲解</h3>
<p><img src="https://image.nickxu.me/202208131206588.png" alt="image-20220813120603448"></p>
<p>（梦回中学时代了属于是，之前 B 站见过讲了所有 RAID 的视频）</p>
<h2 id="HDFS-的数据高可用机制">HDFS 的数据高可用机制</h2>
<h3 id="HDFS-多副本">HDFS 多副本</h3>
<p><img src="https://image.nickxu.me/202208131209318.png" alt="image-20220813120936198"></p>
<h3 id="Erasure-Coding-原理">Erasure Coding 原理</h3>
<p><img src="https://image.nickxu.me/202208131211067.png" alt="image-20220813121135961"></p>
<p>这个和哈希校验和是不一样的，它是大量的数据得到少量的数据，只能起到判断校验的作用。而这边，你的纠筛码的量级和数据的量级是相对接近的，这样可以用它做恢复</p>
<h3 id="HDFS-Erasure-Coding">HDFS Erasure Coding</h3>
<p><img src="https://image.nickxu.me/202208131215315.png" alt="image-20220813121532204"></p>
<p>将纠筛码的机制与条带化的机制结合起来</p>
<h2 id="考虑网络架构的数据高可用">考虑网络架构的数据高可用</h2>
<h3 id="初识网络架构">初识网络架构</h3>
<p><img src="https://image.nickxu.me/202208131218749.png" alt="image-20220813121801606"></p>
<h3 id="副本放置策略-机架感知">副本放置策略 - 机架感知</h3>
<p><img src="https://image.nickxu.me/202208131218065.png" alt="image-20220813121840952"></p>
<p>有很多不同的写入方式</p>
<h2 id="案例：字节跳动的-HDFS-多机房容灾方案简介">案例：字节跳动的 HDFS 多机房容灾方案简介</h2>
<h3 id="多机房实践">多机房实践</h3>
<p><img src="https://image.nickxu.me/202208131220943.png" alt="image-20220813122053817"></p>
<h3 id="容灾">容灾</h3>
<p><img src="https://image.nickxu.me/202208131221961.png" alt="image-20220813122141849"></p>
<h1 id="元数据高扩展性">元数据高扩展性</h1>
<h2 id="元数据扩展性挑战">元数据扩展性挑战</h2>
<h3 id="元数据节点扩展性的挑战">元数据节点扩展性的挑战</h3>
<p><img src="https://image.nickxu.me/202208131222234.png" alt="image-20220813122259116"></p>
<h3 id="常见的-Scale-Out-方案">常见的 Scale Out 方案</h3>
<p><img src="https://image.nickxu.me/202208131224926.png" alt="image-20220813122408816"></p>
<p>3 种方案</p>
<h2 id="社区的解决方案">社区的解决方案</h2>
<h3 id="BlockPool">BlockPool</h3>
<p><img src="https://image.nickxu.me/202208131225518.png" alt="image-20220813122507391"></p>
<h3 id="viewfs">viewfs</h3>
<p><img src="https://image.nickxu.me/202208131226443.png" alt="image-20220813122619321"></p>
<h2 id="字节跳动的-NNProxy-方案">字节跳动的 NNProxy 方案</h2>
<h3 id="字节跳动的-NNProxy">字节跳动的 NNProxy</h3>
<p><img src="https://image.nickxu.me/202208131228303.png" alt="image-20220813122826189"></p>
<h3 id="NNProxy-路由规则保存">NNProxy 路由规则保存</h3>
<p><img src="https://image.nickxu.me/202208131229256.png" alt="image-20220813122936136"></p>
<h3 id="NNProxy-路由转发实现">NNProxy 路由转发实现</h3>
<p><img src="https://image.nickxu.me/202208131230631.png" alt="image-20220813123026505"></p>
<h2 id="案例：小文件问题">案例：小文件问题</h2>
<p><img src="https://image.nickxu.me/202208131232335.png" alt="image-20220813123201217"></p>
<h1 id="存储数据高扩展性">存储数据高扩展性</h1>
<h2 id="超大集群的长尾问题">超大集群的长尾问题</h2>
<h3 id="延迟的分布和长尾延迟">延迟的分布和长尾延迟</h3>
<p><img src="https://image.nickxu.me/202208131236771.png" alt="image-20220813123614661"></p>
<h3 id="尾部延迟放大">尾部延迟放大</h3>
<p><img src="https://image.nickxu.me/202208131237176.png" alt="image-20220813123723067"></p>
<h3 id="长尾问题的表现">长尾问题的表现</h3>
<p><img src="https://image.nickxu.me/202208131238375.png" alt="image-20220813123821259"></p>
<p>后台维护服务经典：Java GC</p>
<h2 id="超大集群的可靠性问题">超大集群的可靠性问题</h2>
<p><img src="https://image.nickxu.me/202208131240610.png" alt="image-20220813124042489"></p>
<h3 id="Copyset">Copyset</h3>
<p><img src="https://image.nickxu.me/202208131241412.png" alt="image-20220813124147305"></p>
<p><img src="https://image.nickxu.me/202208131242776.png" alt="image-20220813124211668"></p>
<h2 id="超大集群的不均匀问题">超大集群的不均匀问题</h2>
<h3 id="负载均衡和数据迁移">负载均衡和数据迁移</h3>
<p><img src="https://image.nickxu.me/202208131242664.png" alt="image-20220813124239531"></p>
<h3 id="数据写入不均">数据写入不均</h3>
<p><img src="https://image.nickxu.me/202208131243488.png" alt="image-20220813124332342"></p>
<h3 id="数据读取不均">数据读取不均</h3>
<p><img src="https://image.nickxu.me/202208131244162.png" alt="image-20220813124404049"></p>
<h3 id="负载均衡和数据迁移的典型场景">负载均衡和数据迁移的典型场景</h3>
<p><img src="https://image.nickxu.me/202208131245155.png" alt="image-20220813124511060"></p>
<h2 id="数据迁移工具速览">数据迁移工具速览</h2>
<h3 id="跨-NN-迁移">跨 NN 迁移</h3>
<p><img src="https://image.nickxu.me/202208131245640.png" alt="image-20220813124529516"></p>
<h3 id="Balancer">Balancer</h3>
<p><img src="https://image.nickxu.me/202208131246766.png" alt="image-20220813124606651"></p>
<h1 id="结语">结语</h1>
<p><img src="https://image.nickxu.me/202208131246707.png" alt="image-20220813124648614"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5/">字节青训营</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/08/03/%E3%80%8E%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5-4th-%E5%A4%A7%E6%95%B0%E6%8D%AE%E3%80%8FL8%EF%BC%9AHDFS-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" title="『字节青训营-4th-大数据』L8：HDFS 原理与应用"><img class="cover" src="/static/202202230023069.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">『字节青训营-4th-大数据』L8：HDFS 原理与应用</div></div><div class="info-2"><div class="info-item-1">相关链接🎶 学员手册：【大数据专场 学习资料三】第四届字节跳动青训营 - 掘金  HDFS 基本介绍   HDFS: Hadoop Distribute File System，是 Hadoop 的一个组件  Windows 单机文件系统  Linux 单机文件系统  分布式文件系统  分布式存储系统  HDFS 功能特性  演示环境  前面两个组件是为了高可用的，本节课主要放在 NameNode 和 DataNode 上   （一个演示视频） 架构原理 HDFS 组件  Client 写流程  Client 读流程  元数据节点 NameNode  知道 NameNode 很重要就可以了（ 数据节点 DataNode  关键设计  NameNode 目录树维护  思考题：为什么不直接在硬盘上修改 fsimage ？ NameNode 数据放置   （一个关于 block 的演示视频） DataNode  后面两个绿框里面的编号是通过哈希算出来的 HDFS 写异常处理 Lease Recovery  租约（Lease）就是一个锁 Pipeline Recovery  这是非常复杂的一部分 Client 读异常处理  旁路系统 异步地解决积累的问题  控制面建设  应用场景 使用 HDFS 的公司  初窥大数据生态  演示：PySpark 读写 HDFS 文件   （一个演示视频） ETL  OLAP 查询引擎  查询引擎很多种，但是都是要对 HDHS 提供支持 HBase  机器学习  通过存储应用  </div></div></div></a><a class="pagination-related" href="/2022/08/06/%E3%80%8E%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5-4th-%E5%A4%A7%E6%95%B0%E6%8D%AE%E3%80%8FL10%EF%BC%9A%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA-HBase-%E5%AE%9E%E6%88%98/" title="『字节青训营-4th-大数据』L10：深入浅出 HBase 实战"><img class="cover" src="/static/202202230023069.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">『字节青训营-4th-大数据』L10：深入浅出 HBase 实战</div></div><div class="info-2"><div class="info-item-1">相关链接🎶 学员手册：【大数据专场 学习资料四】第四届字节跳动青训营 - 掘金https://juejin.cn/post/7124948585614934029#heading-0)   HBase 适用场景 什么是 HBase  HBase 和关系型数据库的区别  HBase 数据模型    这种类 JSON 的格式看上去也是很清晰的  使用场景  典型应用  半结构化 / 字典序有序索引的数据  “近在线” 海量分布式 KV / 宽表存储   写密集的高吞吐场景  HBase 数据模型的优缺点  架构设计 HBase 架构设计  HMaster 主要职责   RegionServer 主要职责   ZooKeeper 主要职责  ThriftServer 主要职责  大数据支撑 HBase 在大数据生态的定位  水平扩展能力  Region 热点切分  切分点选取     切分过程     流量设计  Region 碎片整合  流程设计  Region 负载均衡  调度策略  其他策略  故障恢复机制 HMaster    RegionServer   Distributed Log Split 原理  具体流程    优化空间  最佳实践 Rowkey 设计策略  Column Family 设计策略  参数调优经验  ByteTable - 字节跳动自研分布式表格存储系统  总结  </div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Giscus</span><span id="switch-btn"></span><span class="second-comment">Twikoo</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/static/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Nick Xu</div><div class="author-info-description">这家伙真勤奋，什么都留下了</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">300</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/nickxudotme"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="tencent://message/?uin=976180942&amp;Site=tool.520101.com&amp;Menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/static/weixin.jpg" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="mailto:nx@nickxu.me" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/rss2.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">因为本人最近工作和学习都很忙，所以博客更新会比较慢，敬请谅解！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">元数据高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E9%9C%80%E6%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">高可用的需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E9%9C%80%E6%B1%82"><span class="toc-number">1.1.1.</span> <span class="toc-text">服务高可用的需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E8%A1%A1%E9%87%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">高可用的衡量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E7%9A%84%E5%B9%B4%E5%8C%96"><span class="toc-number">1.1.3.</span> <span class="toc-text">可用性的年化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E5%BD%A2%E5%BC%8F"><span class="toc-number">1.1.4.</span> <span class="toc-text">高可用的形式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS-%E4%B8%BB%E5%A4%87%E5%90%8C%E6%AD%A5%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">HDFS 主备同步实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HDFS-NameNode-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">HDFS NameNode 高可用架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80-%E7%8A%B6%E6%80%81%E6%9C%BA%E5%A4%8D%E5%88%B6%E5%92%8C%E6%97%A5%E5%BF%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">理论基础 - 状态机复制和日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NameNode-%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E7%9A%84%E7%94%9F%E4%BA%A7%E6%B6%88%E8%B4%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">NameNode 操作日志的生产消费</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NameNode-%E5%9D%97%E7%8A%B6%E6%80%81%E7%BB%B4%E6%8A%A4"><span class="toc-number">1.2.4.</span> <span class="toc-text">NameNode 块状态维护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS-%E8%87%AA%E5%8A%A8%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">HDFS 自动主备切换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E7%BB%84%E4%BB%B6-ZooKeeper"><span class="toc-number">1.3.1.</span> <span class="toc-text">分布式协调组件 - ZooKeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E6%B5%81%E7%A8%8B-Server-%E4%BE%A7"><span class="toc-number">1.3.2.</span> <span class="toc-text">自动主备切换流程 - Server 侧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E6%B5%81%E7%A8%8B-Client-%E4%BE%A7"><span class="toc-number">1.3.3.</span> <span class="toc-text">自动主备切换流程 - Client 侧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F-BookKeeper-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.4.</span> <span class="toc-text">日志系统 BookKeeper 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BookKeeper-%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">BookKeeper 架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quorum-%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.2.</span> <span class="toc-text">Quorum 机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BookKeeper-Quorum"><span class="toc-number">1.4.3.</span> <span class="toc-text">BookKeeper Quorum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BookKeeper-Ensemble"><span class="toc-number">1.4.4.</span> <span class="toc-text">BookKeeper Ensemble</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">数据存储高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E6%9C%BA%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.</span> <span class="toc-text">单机存储的数据高可用机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID"><span class="toc-number">2.1.1.</span> <span class="toc-text">RAID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-%E6%96%B9%E6%A1%88%E8%AE%B2%E8%A7%A3"><span class="toc-number">2.1.2.</span> <span class="toc-text">RAID 方案讲解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS-%E7%9A%84%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">2.2.</span> <span class="toc-text">HDFS 的数据高可用机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HDFS-%E5%A4%9A%E5%89%AF%E6%9C%AC"><span class="toc-number">2.2.1.</span> <span class="toc-text">HDFS 多副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Erasure-Coding-%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.2.</span> <span class="toc-text">Erasure Coding 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDFS-Erasure-Coding"><span class="toc-number">2.2.3.</span> <span class="toc-text">HDFS Erasure Coding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E8%99%91%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84%E7%9A%84%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">2.3.</span> <span class="toc-text">考虑网络架构的数据高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.1.</span> <span class="toc-text">初识网络架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E6%94%BE%E7%BD%AE%E7%AD%96%E7%95%A5-%E6%9C%BA%E6%9E%B6%E6%84%9F%E7%9F%A5"><span class="toc-number">2.3.2.</span> <span class="toc-text">副本放置策略 - 机架感知</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E7%9A%84-HDFS-%E5%A4%9A%E6%9C%BA%E6%88%BF%E5%AE%B9%E7%81%BE%E6%96%B9%E6%A1%88%E7%AE%80%E4%BB%8B"><span class="toc-number">2.4.</span> <span class="toc-text">案例：字节跳动的 HDFS 多机房容灾方案简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%9C%BA%E6%88%BF%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.4.1.</span> <span class="toc-text">多机房实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E7%81%BE"><span class="toc-number">2.4.2.</span> <span class="toc-text">容灾</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%AB%98%E6%89%A9%E5%B1%95%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">元数据高扩展性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E6%89%A9%E5%B1%95%E6%80%A7%E6%8C%91%E6%88%98"><span class="toc-number">3.1.</span> <span class="toc-text">元数据扩展性挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9%E6%89%A9%E5%B1%95%E6%80%A7%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">3.1.1.</span> <span class="toc-text">元数据节点扩展性的挑战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84-Scale-Out-%E6%96%B9%E6%A1%88"><span class="toc-number">3.1.2.</span> <span class="toc-text">常见的 Scale Out 方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BE%E5%8C%BA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.2.</span> <span class="toc-text">社区的解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BlockPool"><span class="toc-number">3.2.1.</span> <span class="toc-text">BlockPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#viewfs"><span class="toc-number">3.2.2.</span> <span class="toc-text">viewfs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E7%9A%84-NNProxy-%E6%96%B9%E6%A1%88"><span class="toc-number">3.3.</span> <span class="toc-text">字节跳动的 NNProxy 方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E7%9A%84-NNProxy"><span class="toc-number">3.3.1.</span> <span class="toc-text">字节跳动的 NNProxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NNProxy-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E4%BF%9D%E5%AD%98"><span class="toc-number">3.3.2.</span> <span class="toc-text">NNProxy 路由规则保存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NNProxy-%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.3.</span> <span class="toc-text">NNProxy 路由转发实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%B0%8F%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.</span> <span class="toc-text">案例：小文件问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E9%AB%98%E6%89%A9%E5%B1%95%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">存储数据高扩展性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E5%A4%A7%E9%9B%86%E7%BE%A4%E7%9A%84%E9%95%BF%E5%B0%BE%E9%97%AE%E9%A2%98"><span class="toc-number">4.1.</span> <span class="toc-text">超大集群的长尾问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E7%9A%84%E5%88%86%E5%B8%83%E5%92%8C%E9%95%BF%E5%B0%BE%E5%BB%B6%E8%BF%9F"><span class="toc-number">4.1.1.</span> <span class="toc-text">延迟的分布和长尾延迟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%BE%E9%83%A8%E5%BB%B6%E8%BF%9F%E6%94%BE%E5%A4%A7"><span class="toc-number">4.1.2.</span> <span class="toc-text">尾部延迟放大</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E5%B0%BE%E9%97%AE%E9%A2%98%E7%9A%84%E8%A1%A8%E7%8E%B0"><span class="toc-number">4.1.3.</span> <span class="toc-text">长尾问题的表现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E5%A4%A7%E9%9B%86%E7%BE%A4%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.</span> <span class="toc-text">超大集群的可靠性问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Copyset"><span class="toc-number">4.2.1.</span> <span class="toc-text">Copyset</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E5%A4%A7%E9%9B%86%E7%BE%A4%E7%9A%84%E4%B8%8D%E5%9D%87%E5%8C%80%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.</span> <span class="toc-text">超大集群的不均匀问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">负载均衡和数据迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E4%B8%8D%E5%9D%87"><span class="toc-number">4.3.2.</span> <span class="toc-text">数据写入不均</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%9D%87"><span class="toc-number">4.3.3.</span> <span class="toc-text">数据读取不均</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E7%9A%84%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.4.</span> <span class="toc-text">负载均衡和数据迁移的典型场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%B7%A5%E5%85%B7%E9%80%9F%E8%A7%88"><span class="toc-number">4.4.</span> <span class="toc-text">数据迁移工具速览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8-NN-%E8%BF%81%E7%A7%BB"><span class="toc-number">4.4.1.</span> <span class="toc-text">跨 NN 迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Balancer"><span class="toc-number">4.4.2.</span> <span class="toc-text">Balancer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/from-hello-world-to-tencent.html" title="编程十年：那些人，那些事，那些瞬间">编程十年：那些人，那些事，那些瞬间</a><time datetime="2025-10-28T17:59:49.000Z" title="发表于 2025-10-29 01:59:49">2025-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/six-months-in-Tencent.html" title="腾讯六月：未曾拥有过的美好时光😘">腾讯六月：未曾拥有过的美好时光😘</a><time datetime="2024-12-07T08:24:50.000Z" title="发表于 2024-12-07 16:24:50">2024-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/be-your-authentic-self.html" title="做原汁原味的自己">做原汁原味的自己</a><time datetime="2024-10-15T17:28:43.000Z" title="发表于 2024-10-16 01:28:43">2024-10-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/seven-months-of-struggle-main-part-3.html" title="『七个月的挣扎之路』支线合集">『七个月的挣扎之路』支线合集</a><time datetime="2024-07-15T13:59:55.000Z" title="发表于 2024-07-15 21:59:55">2024-07-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/seven-months-of-struggle-main-part-2.html" title="『七个月的挣扎之路』主线：简历、面试与找工作（下）">『七个月的挣扎之路』主线：简历、面试与找工作（下）</a><time datetime="2024-07-15T13:56:53.000Z" title="发表于 2024-07-15 21:56:53">2024-07-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By Nick Xu</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="/js/tw_cn.js?v=5.5.3"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'nickxudotme/nickxudotme.github.io',
      'data-repo-id': 'R_kgDOGzWHdw',
      'data-category-id': 'DIC_kwDOGzWHd84CX4Hy',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.nickxu.top/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.nickxu.top/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js?v=1.6.44').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Giscus' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Giscus' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer="defer" id="ribbon" src="/pluginsSrc/butterfly-extsrc/dist/canvas-ribbon.min.js?v=1.1.6" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>